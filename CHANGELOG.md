# APIæ›´æ–°æ—¥å¿—

## ğŸ“… 2025-07-18 - API è¿æ¥ä¿®å¤
### ğŸ”§ ä¿®å¤å†…å®¹
- **ç«¯å£é…ç½®**: ç»Ÿä¸€ç«¯å£ä» 5004 ä¿®æ­£ä¸º 5002ï¼Œä¸åç«¯æœåŠ¡ä¿æŒä¸€è‡´
- **ç®¡ç†å‘˜ç™»å½•**: ä¿®æ­£ç™»å½• API è·¯å¾„ä» `/api/auth/login` æ”¹ä¸º `/auth/login`
- **è¯·æ±‚å®ä¾‹**: æ–°å¢ `adminRequest` å®ä¾‹å¤„ç†ç®¡ç†å‘˜ä¸“ç”¨ API
- **API è·¯å¾„**: ä¿®æ­£æ‰€æœ‰ç®¡ç†å‘˜ API è·¯å¾„æ˜ å°„
- **è¯Šæ–­å·¥å…·**: æ›´æ–°æ‰€æœ‰æµ‹è¯•å’Œè¯Šæ–­å·¥å…·çš„é…ç½®

### ğŸ†• æ–°å¢åŠŸèƒ½
- åˆ›å»º `adminRequest` ä¸“ç”¨è¯·æ±‚å®ä¾‹
- æ–°å¢ `api-connection-test.js` è¿æ¥æµ‹è¯•è„šæœ¬
- æ–°å¢ `API_FIX_SUMMARY.md` ä¿®å¤æ‘˜è¦æ–‡æ¡£

## ğŸ“… 2024å¹´1æœˆ - åŸºäºæ–°çš„APIæ–‡æ¡£è¿›è¡Œå…¨é¢é‡æ„

## ğŸ”„ ä¸»è¦å˜æ›´

### 1. åŸºç¡€é…ç½®æ›´æ–°
- **APIåŸºç¡€åœ°å€**: ä» `/api` æ›´æ–°ä¸º `http://localhost:5002/api`
- **å“åº”æ ¼å¼**: ç»Ÿä¸€ä¸º `{ success: boolean, data: any, message: string }` æ ¼å¼
- **é”™è¯¯å¤„ç†**: å¢åŠ äº†æ›´å¤šé”™è¯¯ç çš„å¤„ç†ï¼ˆ400, 409, 413, 415ç­‰ï¼‰

### 2. æ–°å¢APIæ¨¡å—

#### ğŸ“ `/src/api/` ç›®å½•ç»“æ„
```
src/api/
â”œâ”€â”€ index.js           # ç»Ÿä¸€å¯¼å‡ºæ–‡ä»¶ âœ¨ æ–°å¢
â”œâ”€â”€ auth.js            # è®¤è¯API âœ¨ æ–°å¢
â”œâ”€â”€ user.js            # ç”¨æˆ·ç®¡ç†API ğŸ”„ é‡æ„
â”œâ”€â”€ image.js           # å›¾ç‰‡ç®¡ç†API âœ¨ æ–°å¢
â”œâ”€â”€ generate.js        # å›¾ç‰‡ç”ŸæˆAPI âœ¨ æ–°å¢
â”œâ”€â”€ upload.js          # æ–‡ä»¶ä¸Šä¼ API âœ¨ æ–°å¢
â”œâ”€â”€ dashboard.js       # ä»ªè¡¨ç›˜API ğŸ”„ é‡æ„
â””â”€â”€ system.js          # ç³»ç»Ÿè®¾ç½®API âœ¨ æ–°å¢
```

### 3. APIæ¥å£å˜æ›´

#### è®¤è¯æ¨¡å— (auth.js)
- âœ¨ æ–°å¢ `register()` - ç”¨æˆ·æ³¨å†Œ
- ğŸ”„ æ›´æ–° `login()` - é€‚é…æ–°çš„å“åº”æ ¼å¼
- ğŸ”„ æ›´æ–° `getUserInfo()` - ä½¿ç”¨ `/user/profile` æ¥å£
- âŒ ç§»é™¤ `validateToken()` - é€šè¿‡getUserInfoéªŒè¯

#### ç”¨æˆ·ç®¡ç†æ¨¡å— (user.js)
- ğŸ”„ æ›´æ–°æ¥å£è·¯å¾„ï¼š`/api/users` â†’ `/admin/users`
- âœ¨ æ–°å¢ `createUser()` - åˆ›å»ºç”¨æˆ·
- âœ¨ æ–°å¢ `updateUser()` - æ›´æ–°ç”¨æˆ·
- âœ¨ æ–°å¢ `batchDeleteUsers()` - æ‰¹é‡åˆ é™¤ç”¨æˆ·
- ğŸ”„ æ›´æ–°å‚æ•°æ ¼å¼ï¼š`ids` â†’ `userIds`

#### å›¾ç‰‡ç®¡ç†æ¨¡å— (image.js) âœ¨ å…¨æ–°æ¨¡å—
- âœ¨ æ–°å¢ `getImages()` - è·å–å›¾ç‰‡åˆ—è¡¨
- âœ¨ æ–°å¢ `getImageDetail()` - è·å–å›¾ç‰‡è¯¦æƒ…
- âœ¨ æ–°å¢ `deleteImage()` - åˆ é™¤å›¾ç‰‡
- âœ¨ æ–°å¢ `batchDeleteImages()` - æ‰¹é‡åˆ é™¤å›¾ç‰‡

#### å›¾ç‰‡ç”Ÿæˆæ¨¡å— (generate.js) âœ¨ å…¨æ–°æ¨¡å—
- âœ¨ æ–°å¢ `generateImage()` - ç”Ÿæˆå›¾ç‰‡
- âœ¨ æ–°å¢ `getGenerationHistory()` - è·å–ç”Ÿæˆå†å²

#### æ–‡ä»¶ä¸Šä¼ æ¨¡å— (upload.js) âœ¨ å…¨æ–°æ¨¡å—
- âœ¨ æ–°å¢ `uploadAvatar()` - ä¸Šä¼ å¤´åƒ
- âœ¨ æ–°å¢ `uploadFile()` - é€šç”¨æ–‡ä»¶ä¸Šä¼ 

#### ä»ªè¡¨ç›˜æ¨¡å— (dashboard.js)
- ğŸ”„ æ›´æ–° `getStats()` - ä½¿ç”¨ `/admin/system/info` æ¥å£
- ğŸ”„ ä¿æŒå…¶ä»–æ¥å£ä¸å˜

#### ç³»ç»Ÿè®¾ç½®æ¨¡å— (system.js) âœ¨ å…¨æ–°æ¨¡å—
- âœ¨ æ–°å¢ `getSystemInfo()` - è·å–ç³»ç»Ÿä¿¡æ¯
- âœ¨ æ–°å¢ `getSystemConfig()` - è·å–ç³»ç»Ÿé…ç½®
- âœ¨ æ–°å¢ `updateSystemConfig()` - æ›´æ–°ç³»ç»Ÿé…ç½®
- âœ¨ æ–°å¢ `clearCache()` - æ¸…ç†ç³»ç»Ÿç¼“å­˜

### 4. çŠ¶æ€ç®¡ç†æ›´æ–°

#### è®¤è¯Store (auth.js)
- ğŸ”„ æ›´æ–°å¯¼å…¥è·¯å¾„ï¼š`@/utils/api` â†’ `@/api/auth`
- ğŸ”„ æ›´æ–°ç™»å½•å“åº”å¤„ç†ï¼šé€‚é…æ–°çš„æ•°æ®ç»“æ„
- ğŸ”„ æ›´æ–°é”™è¯¯å¤„ç†ï¼šæ”¯æŒæ›´å¤šé”™è¯¯ç 
- âŒ ç§»é™¤ `validateToken()` æ–¹æ³•
- ğŸ”„ æ›´æ–° `restoreFromStorage()` - é€šè¿‡getUserInfoéªŒè¯token

### 5. å·¥å…·æ–‡ä»¶æ›´æ–°

#### è¯·æ±‚å·¥å…· (request.js)
- ğŸ”„ æ›´æ–°baseURLï¼š`/api` â†’ `http://localhost:5004/api`
- ğŸ”„ ç®€åŒ–å“åº”æ‹¦æˆªå™¨ï¼šç›´æ¥è¿”å›å“åº”æ•°æ®
- ğŸ”„ å¢å¼ºé”™è¯¯å¤„ç†ï¼šæ”¯æŒæ›´å¤šHTTPçŠ¶æ€ç 

#### APIå·¥å…· (api.js)
- ğŸ”„ ä¿ç•™åŸæœ‰æ¥å£ï¼Œç¡®ä¿å‘åå…¼å®¹
- âœ¨ æ–°å¢å›¾ç‰‡ç”Ÿæˆå’Œæ–‡ä»¶ä¸Šä¼ API
- ğŸ”„ æ›´æ–°æ‰€æœ‰æ¥å£çš„æ³¨é‡Šå’Œå‚æ•°è¯´æ˜

### 6. æ–°å¢æ–‡æ¡£å’Œå·¥å…·

#### ğŸ“š æ–‡æ¡£
- âœ¨ `API_USAGE_GUIDE.md` - è¯¦ç»†çš„APIä½¿ç”¨æŒ‡å—
- âœ¨ `CHANGELOG.md` - æœ¬æ›´æ–°æ—¥å¿—

#### ğŸ”§ å·¥å…·
- âœ¨ `api-test.js` - APIæµ‹è¯•å·¥å…·
- âœ¨ `api/index.js` - ç»Ÿä¸€å¯¼å‡ºæ–‡ä»¶

## ğŸš€ ä½¿ç”¨æ–¹å¼

### æ–°çš„å¯¼å…¥æ–¹å¼ï¼ˆæ¨èï¼‰
```javascript
// æŒ‰éœ€å¯¼å…¥
import { userAPI, authAPI } from '@/api'

// å¯¼å…¥æ‰€æœ‰API
import api from '@/api'
```

### å…¼å®¹æ€§å¯¼å…¥æ–¹å¼
```javascript
// ä¿æŒå‘åå…¼å®¹
import { userAPI } from '@/utils/api'
```

## ğŸ”§ è¿ç§»æŒ‡å—

### 1. æ›´æ–°å¯¼å…¥è¯­å¥
```javascript
// æ—§æ–¹å¼
import { authAPI } from '@/utils/api'

// æ–°æ–¹å¼
import { authAPI } from '@/api'
```

### 2. æ›´æ–°APIè°ƒç”¨
```javascript
// æ‰¹é‡åˆ é™¤ç”¨æˆ· - å‚æ•°åå˜æ›´
// æ—§æ–¹å¼
userAPI.batchDeleteUsers([1, 2, 3])

// æ–°æ–¹å¼
userAPI.batchDeleteUsers([1, 2, 3]) // å†…éƒ¨å·²æ›´æ–°ä¸ºuserIds
```

### 3. æ›´æ–°é”™è¯¯å¤„ç†
```javascript
// æ–°å¢çš„é”™è¯¯ç å¤„ç†
try {
  await api.upload.uploadAvatar(file)
} catch (error) {
  if (error.response?.status === 413) {
    // æ–‡ä»¶è¿‡å¤§
  } else if (error.response?.status === 415) {
    // ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹
  }
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å‘åå…¼å®¹**: ä¿ç•™äº† `/src/utils/api.js` æ–‡ä»¶ï¼Œç¡®ä¿ç°æœ‰ä»£ç ä¸ä¼šä¸­æ–­
2. **æ–°åŠŸèƒ½**: å›¾ç‰‡ç”Ÿæˆã€æ–‡ä»¶ä¸Šä¼ ç­‰æ–°åŠŸèƒ½éœ€è¦ä½¿ç”¨æ–°çš„APIæ¨¡å—
3. **è®¤è¯**: æ‰€æœ‰ç®¡ç†å‘˜æ¥å£ï¼ˆ/admin/*ï¼‰éœ€è¦adminè§’è‰²æƒé™
4. **æµ‹è¯•**: ä½¿ç”¨ `api-test.js` å·¥å…·éªŒè¯APIé…ç½®

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

1. æ·»åŠ TypeScriptç±»å‹å®šä¹‰
2. å®ç°APIç¼“å­˜æœºåˆ¶
3. æ·»åŠ è¯·æ±‚é‡è¯•æœºåˆ¶
4. ä¼˜åŒ–é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º