import{g as pe,K as fe,b as ve,d as ge,e as be,f as he,L as ye,M as Ce,N as we,O as Ee,P as Te,Q as xe,w as Ae,x as ke,R as ze,D as Ue,F as Le,S as Se,T as Ve,B as De,u as N,J as Be,U as $e,V as Ie,W as Ze,X as Pe,Y as Me,Z as Ne,E as b,y as B}from"./element-plus-wIhg9Y3M.js";import{dT as Re,bu as y,cl as R,bQ as Fe,bT as A,bU as C,bV as n,cb as e,c4 as t,c8 as o,bw as c,cB as F,c5 as Ke,c9 as i,c3 as O,c6 as Oe,bL as je}from"./vendor-CXaOXOXP.js";import{u as k}from"./api-D78is_CB.js";import{f as z,g as K}from"./index-zFB-kJVX.js";import{_ as Qe}from"./index-BLw7aUal.js";const Je={class:"users-list"},We={class:"page-header"},Xe={class:"header-right"},Ye={class:"search-section"},qe={class:"table-section"},Ge={class:"table-toolbar"},He={class:"toolbar-left"},et={class:"toolbar-right"},tt={class:"user-info"},at={class:"user-details"},lt={class:"username"},st={class:"email"},nt={class:"time-info"},ot={class:"relative-time"},it={key:0,class:"time-info"},dt={class:"relative-time"},ut={key:1,class:"no-data"},rt={class:"pagination-wrapper"},ct={key:0,class:"user-detail"},_t={class:"detail-header"},mt={class:"user-basic"},pt={__name:"List",setup(j){const U=Re(),E=y(!1),w=y([]),v=y([]),$=y("default"),T=y(!1),d=y(null),m=R({username:"",email:"",status:""}),u=R({page:1,pageSize:20,total:0}),p=async()=>{E.value=!0;try{const s={page:u.page,pageSize:u.pageSize,...m},a=await k.getUsers(s);console.log("API响应:",a),a.success&&a.data?(w.value=a.data.list||[],u.total=a.data.total||0,console.log("用户列表:",w.value),console.log("总数:",u.total)):(console.log("API失败，使用测试数据"),w.value=[{id:1,username:"testuser1",email:"test1@example.com",status:"active",imageCount:5,createdAt:"2024-12-01T10:30:00Z",lastLoginAt:"2024-12-19T09:15:00Z"},{id:2,username:"testuser2",email:"test2@example.com",status:"active",imageCount:3,createdAt:"2024-11-15T14:20:00Z",lastLoginAt:"2024-12-18T16:45:00Z"},{id:3,username:"testuser3",email:"test3@example.com",status:"inactive",imageCount:0,createdAt:"2024-10-20T08:10:00Z",lastLoginAt:null}],u.total=3)}catch(s){b.error("加载用户列表失败"),console.error("加载用户列表失败:",s),w.value=[{id:1,username:"testuser1",email:"test1@example.com",status:"active",imageCount:5,createdAt:"2024-12-01T10:30:00Z",lastLoginAt:"2024-12-19T09:15:00Z"},{id:2,username:"testuser2",email:"test2@example.com",status:"active",imageCount:3,createdAt:"2024-11-15T14:20:00Z",lastLoginAt:"2024-12-18T16:45:00Z"},{id:3,username:"testuser3",email:"test3@example.com",status:"inactive",imageCount:0,createdAt:"2024-10-20T08:10:00Z",lastLoginAt:null}],u.total=3}finally{E.value=!1}},L=()=>{u.page=1,p()},Q=()=>{Object.assign(m,{username:"",email:"",status:""}),u.page=1,p()},J=()=>{p()},W=s=>{v.value=s},X=s=>{$.value=s},Y=s=>{u.pageSize=s,u.page=1,p()},q=s=>{u.page=s,p()},G=s=>{U.push(`/users/${s.id}`)},H=()=>{T.value=!1,d.value=null},I=s=>{U.push(`/images/list?userId=${s}`)},ee=async s=>{const a=s.status==="active"?"禁用":"启用",_=s.status==="active"?"disabled":"active";try{await B.confirm(`确定要${a}用户 "${s.username}" 吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await k.updateUserStatus(s.id,_),s.status=_,b.success(`${a}成功`)}catch(r){r!=="cancel"&&(b.error(`${a}失败`),console.error("切换用户状态失败:",r))}},te=async s=>{try{await B.confirm(`确定要删除用户 "${s.username}" 吗？此操作不可恢复！`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await k.deleteUser(s.id),b.success("删除成功"),p()}catch(a){a!=="cancel"&&(b.error("删除失败"),console.error("删除用户失败:",a))}},ae=async()=>{if(v.value.length!==0)try{await B.confirm(`确定要删除选中的 ${v.value.length} 个用户吗？此操作不可恢复！`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const s=v.value.map(a=>a.id);await k.batchDeleteUsers(s),b.success("批量删除成功"),v.value=[],p()}catch(s){s!=="cancel"&&(b.error("批量删除失败"),console.error("批量删除失败:",s))}};return Fe(()=>{p()}),(s,a)=>{const _=pe,r=ve,Z=he,x=be,S=Ce,le=ye,se=ge,P=Te,V=Le,ne=Ue,oe=ke,ie=Ae,f=Ve,M=De,D=Be,de=$e,ue=Se,re=Ze,g=Me,ce=Pe,_e=Ne,me=Ie;return C(),A("div",Je,[n("div",We,[a[9]||(a[9]=n("div",{class:"header-left"},[n("h2",{class:"page-title"},"用户管理"),n("p",{class:"page-description"},"管理系统中的所有用户信息")],-1)),n("div",Xe,[e(r,{type:"primary",onClick:J},{default:t(()=>[e(_,null,{default:t(()=>[e(c(fe))]),_:1}),a[8]||(a[8]=o(" 刷新 "))]),_:1,__:[8]})])]),n("div",Ye,[e(P,{shadow:"never"},{default:t(()=>[e(se,{model:m,inline:""},{default:t(()=>[e(x,{label:"用户名"},{default:t(()=>[e(Z,{modelValue:m.username,"onUpdate:modelValue":a[0]||(a[0]=l=>m.username=l),placeholder:"请输入用户名",clearable:"",onKeyup:F(L,["enter"])},null,8,["modelValue"])]),_:1}),e(x,{label:"邮箱"},{default:t(()=>[e(Z,{modelValue:m.email,"onUpdate:modelValue":a[1]||(a[1]=l=>m.email=l),placeholder:"请输入邮箱",clearable:"",onKeyup:F(L,["enter"])},null,8,["modelValue"])]),_:1}),e(x,{label:"状态"},{default:t(()=>[e(le,{modelValue:m.status,"onUpdate:modelValue":a[2]||(a[2]=l=>m.status=l),placeholder:"请选择状态",clearable:""},{default:t(()=>[e(S,{label:"全部",value:""}),e(S,{label:"活跃",value:"active"}),e(S,{label:"禁用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),e(x,null,{default:t(()=>[e(r,{type:"primary",onClick:L},{default:t(()=>[e(_,null,{default:t(()=>[e(c(we))]),_:1}),a[10]||(a[10]=o(" 搜索 "))]),_:1,__:[10]}),e(r,{onClick:Q},{default:t(()=>[e(_,null,{default:t(()=>[e(c(Ee))]),_:1}),a[11]||(a[11]=o(" 重置 "))]),_:1,__:[11]})]),_:1})]),_:1},8,["model"])]),_:1})]),n("div",qe,[e(P,{shadow:"never"},{default:t(()=>[n("div",Ge,[n("div",He,[e(r,{type:"danger",disabled:v.value.length===0,onClick:ae},{default:t(()=>[e(_,null,{default:t(()=>[e(c(xe))]),_:1}),o(" 批量删除 ("+i(v.value.length)+") ",1)]),_:1},8,["disabled"])]),n("div",et,[e(ie,{content:"密度"},{default:t(()=>[e(oe,{onCommand:X},{dropdown:t(()=>[e(ne,null,{default:t(()=>[e(V,{command:"large"},{default:t(()=>a[12]||(a[12]=[o("宽松")])),_:1,__:[12]}),e(V,{command:"default"},{default:t(()=>a[13]||(a[13]=[o("默认")])),_:1,__:[13]}),e(V,{command:"small"},{default:t(()=>a[14]||(a[14]=[o("紧凑")])),_:1,__:[14]})]),_:1})]),default:t(()=>[e(r,{circle:""},{default:t(()=>[e(_,null,{default:t(()=>[e(c(ze))]),_:1})]),_:1})]),_:1})]),_:1})])]),Ke((C(),O(ue,{data:w.value,size:$.value,onSelectionChange:W,stripe:"",border:""},{default:t(()=>[e(f,{type:"selection",width:"55",align:"center"}),e(f,{label:"用户信息","min-width":"200"},{default:t(({row:l})=>[n("div",tt,[e(M,{size:32,src:l.avatar},{default:t(()=>[e(_,null,{default:t(()=>[e(c(N))]),_:1})]),_:2},1032,["src"]),n("div",at,[n("div",lt,i(l.username),1),n("div",st,i(l.email),1)])])]),_:1}),e(f,{label:"用户ID",prop:"id",width:"100",align:"center"}),e(f,{label:"状态",width:"100",align:"center"},{default:t(({row:l})=>[e(D,{type:l.status==="active"?"success":"danger",size:"small"},{default:t(()=>[o(i(l.status==="active"?"活跃":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(f,{label:"图片数量",prop:"imageCount",width:"100",align:"center"},{default:t(({row:l})=>[e(de,{type:"primary",onClick:h=>I(l.id)},{default:t(()=>[o(i(l.imageCount||0),1)]),_:2},1032,["onClick"])]),_:1}),e(f,{label:"注册时间",width:"180",align:"center"},{default:t(({row:l})=>[n("div",nt,[n("div",null,i(c(z)(l.createdAt)),1),n("div",ot,i(c(K)(l.createdAt)),1)])]),_:1}),e(f,{label:"最后登录",width:"180",align:"center"},{default:t(({row:l})=>[l.lastLoginAt?(C(),A("div",it,[n("div",null,i(c(z)(l.lastLoginAt)),1),n("div",dt,i(c(K)(l.lastLoginAt)),1)])):(C(),A("span",ut,"从未登录"))]),_:1}),e(f,{label:"操作",width:"250",align:"center",fixed:"right"},{default:t(({row:l})=>[e(r,{type:"info",size:"small",onClick:h=>G(l)},{default:t(()=>a[15]||(a[15]=[o(" 详情 ")])),_:2,__:[15]},1032,["onClick"]),e(r,{type:"primary",size:"small",onClick:h=>ee(l)},{default:t(()=>[o(i(l.status==="active"?"禁用":"启用"),1)]),_:2},1032,["onClick"]),e(r,{type:"danger",size:"small",onClick:h=>te(l)},{default:t(()=>a[16]||(a[16]=[o(" 删除 ")])),_:2,__:[16]},1032,["onClick"])]),_:1})]),_:1},8,["data","size"])),[[me,E.value]]),n("div",rt,[e(re,{"current-page":u.page,"onUpdate:currentPage":a[3]||(a[3]=l=>u.page=l),"page-size":u.pageSize,"onUpdate:pageSize":a[4]||(a[4]=l=>u.pageSize=l),total:u.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Y,onCurrentChange:q},null,8,["current-page","page-size","total"])])]),_:1})]),e(_e,{modelValue:T.value,"onUpdate:modelValue":a[7]||(a[7]=l=>T.value=l),title:"用户详情",width:"600px","before-close":H},{footer:t(()=>[e(r,{onClick:a[5]||(a[5]=l=>T.value=!1)},{default:t(()=>a[17]||(a[17]=[o("关闭")])),_:1,__:[17]}),e(r,{type:"primary",onClick:a[6]||(a[6]=l=>{var h;return((h=d.value)==null?void 0:h.id)&&I(d.value.id)})},{default:t(()=>a[18]||(a[18]=[o(" 查看图片 ")])),_:1,__:[18]})]),default:t(()=>[d.value?(C(),A("div",ct,[n("div",_t,[e(M,{size:64,src:d.value.avatar},{default:t(()=>[e(_,null,{default:t(()=>[e(c(N))]),_:1})]),_:1},8,["src"]),n("div",mt,[n("h3",null,i(d.value.username),1),n("p",null,i(d.value.email),1),e(D,{type:d.value.status==="active"?"success":"danger"},{default:t(()=>[o(i(d.value.status==="active"?"活跃用户":"已禁用"),1)]),_:1},8,["type"])])]),e(ce,{column:2,border:""},{default:t(()=>[e(g,{label:"用户ID"},{default:t(()=>[o(i(d.value.id),1)]),_:1}),e(g,{label:"用户名"},{default:t(()=>[o(i(d.value.username),1)]),_:1}),e(g,{label:"邮箱"},{default:t(()=>[o(i(d.value.email),1)]),_:1}),e(g,{label:"状态"},{default:t(()=>[e(D,{type:d.value.status==="active"?"success":"danger"},{default:t(()=>[o(i(d.value.status==="active"?"活跃":"禁用"),1)]),_:1},8,["type"])]),_:1}),e(g,{label:"图片数量"},{default:t(()=>[o(i(d.value.imageCount||0),1)]),_:1}),e(g,{label:"注册时间"},{default:t(()=>[o(i(c(z)(d.value.createdAt)),1)]),_:1}),e(g,{label:"最后登录"},{default:t(()=>[o(i(d.value.lastLoginAt?c(z)(d.value.lastLoginAt):"从未登录"),1)]),_:1})]),_:1})])):Oe("",!0)]),_:1},8,["modelValue"])])}}},ft=Qe(pt,[["__scopeId","data-v-3c2ff70d"]]),Ct=je({__name:"index",setup(j){return(U,E)=>(C(),O(ft))}});export{Ct as default};
