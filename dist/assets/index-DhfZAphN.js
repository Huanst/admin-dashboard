import{P as pe,E as k,d as _e,e as me,f as ge,a9 as ve,aa as fe,L as he,M as ye,ab as be,b as we,g as xe,a0 as ze,ac as ke,a1 as Ie,a6 as Ce,a4 as Ee,V as Ve,W as Ue}from"./element-plus-wIhg9Y3M.js";import{r as V,_ as K}from"./index-BLw7aUal.js";import{f as Fe}from"./index-zFB-kJVX.js";import{bL as M,bu as h,cl as H,bQ as Le,bT as i,bV as s,cb as e,c4 as a,c3 as q,c6 as D,c8 as U,db as F,c9 as y,ca as N,cD as T,c5 as Se,bw as De,bU as r}from"./vendor-CXaOXOXP.js";const X={generateImage(d){return V.post("/api/generate-image",{width:1024,height:1024,num_inference_steps:20,guidance_scale:7.5,model:"black-forest-labs/FLUX.1-schnell",...d})},generateImageLegacy(d){return V.post("/api/generate-image",{width:1024,height:1024,num_inference_steps:20,guidance_scale:7.5,model:"black-forest-labs/FLUX.1-schnell",...d})},getUserImages(d={}){return V.get("/api/user/images",{params:d})},getUserGenerations(d={}){return V.get("/api/user/generations",{params:d})},getGenerationHistory(d={}){return this.getUserImages(d)}},Ae={class:"generate-form"},Pe={class:"generate-container"},Re={class:"form-section"},Ge={class:"result-section"},$e={class:"card-header"},Be={key:0,class:"generating-status"},He={class:"progress-info"},qe={key:1,class:"empty-result"},Ne={key:2,class:"image-grid"},Te={class:"image-wrapper"},Xe={class:"image-error"},Ke={class:"image-overlay"},Me={class:"image-info"},Oe={class:"image-prompt"},Qe={class:"image-meta"},We={class:"history-section"},je={class:"card-header"},Je={key:0,class:"empty-history"},Ye={key:1,class:"history-grid"},Ze=["onClick"],et={class:"image-error"},tt={class:"history-info"},at={class:"history-prompt"},st={class:"history-time"},ot={key:2,class:"history-pagination"},lt=M({__name:"GenerateForm",setup(d){const x=h(),n=H({prompt:"",image_size:"1024x1024",model:"black-forest-labs/FLUX.1-schnell",batch_size:1,seed:null}),O={prompt:[{required:!0,message:"请输入图片描述",trigger:"blur"},{min:5,max:500,message:"描述长度应为5-500个字符",trigger:"blur"}],image_size:[{required:!0,message:"请选择图片尺寸",trigger:"change"}],model:[{required:!0,message:"请选择AI模型",trigger:"change"}],batch_size:[{required:!0,message:"请设置生成数量",trigger:"change"}]},b=h(!1),_=h(0),g=h(""),v=h([]),L=h(!1),I=h([]),c=H({page:1,pageSize:12,total:0}),Q=async()=>{if(!(!x.value||!await x.value.validate().catch(()=>!1))){b.value=!0,_.value=0,g.value="准备生成...";try{const t=setInterval(()=>{_.value<90&&(_.value+=Math.random()*10,_.value<30?g.value="正在处理提示词...":_.value<60?g.value="AI模型生成中...":g.value="图片渲染中...")},500),u=await X.generateImage(n);if(clearInterval(t),_.value=100,g.value="生成完成！",u.status==="success"){const p=Array.isArray(u.data)?u.data:[u.data];v.value.unshift(...p.map(m=>({...m,prompt:n.prompt,size:n.image_size,model:n.model}))),k.success(`成功生成 ${p.length} 张图片`),z()}else throw new Error(u.message||"生成失败")}catch(t){console.error("生成图片失败:",t),k.error(t.message||"生成失败，请稍后重试")}finally{b.value=!1,setTimeout(()=>{_.value=0,g.value=""},2e3)}}},W=()=>{var l;(l=x.value)==null||l.resetFields(),n.seed=null},j=()=>{v.value=[]},J=l=>{const t=document.createElement("a");t.href=l.url,t.download=`generated-${Date.now()}.png`,t.click()},Y=async l=>{try{await navigator.clipboard.writeText(l),k.success("图片链接已复制到剪贴板")}catch{k.error("复制失败")}},z=async()=>{L.value=!0;try{const l=await X.getGenerationHistory({page:c.page,pageSize:c.pageSize});l.status==="success"&&(I.value=l.data.list||[],c.total=l.data.total||0)}catch(l){console.error("加载历史记录失败:",l),k.error("加载历史记录失败")}finally{L.value=!1}},Z=l=>{v.value.findIndex(u=>u.id===l.id)===-1&&v.value.unshift({...l,prompt:l.prompt,size:l.image_size||"1024x1024",model:l.model||"unknown"})},ee=l=>{c.pageSize=l,c.page=1,z()},te=l=>{c.page=l,z()};return Le(()=>{z()}),(l,t)=>{const u=ge,p=me,m=ye,A=he,C=fe,P=ve,R=be,E=F("Picture"),f=xe,w=we,ae=_e,S=pe,se=ze,oe=ke,G=Ie,$=Ce,le=F("Download"),ne=F("CopyDocument"),re=Ee,ie=F("Refresh"),de=Ue,ce=Ve;return r(),i("div",Ae,[t[14]||(t[14]=s("div",{class:"page-header"},[s("div",{class:"header-left"},[s("h2",{class:"page-title"},"AI图片生成"),s("p",{class:"page-description"},"使用AI技术生成高质量图片")])],-1)),s("div",Pe,[s("div",Re,[e(S,{shadow:"never",class:"form-card"},{header:a(()=>t[7]||(t[7]=[s("div",{class:"card-header"},[s("span",null,"生成配置")],-1)])),default:a(()=>[e(ae,{ref_key:"generateFormRef",ref:x,model:n,rules:O,"label-width":"120px",class:"generate-form-content"},{default:a(()=>[e(p,{label:"图片描述",prop:"prompt"},{default:a(()=>[e(u,{modelValue:n.prompt,"onUpdate:modelValue":t[0]||(t[0]=o=>n.prompt=o),type:"textarea",rows:4,placeholder:"请输入图片描述，例如：一幅美丽的山水画，有蓝天白云和清澈的湖水",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(P,{gutter:20},{default:a(()=>[e(C,{span:12},{default:a(()=>[e(p,{label:"图片尺寸",prop:"image_size"},{default:a(()=>[e(A,{modelValue:n.image_size,"onUpdate:modelValue":t[1]||(t[1]=o=>n.image_size=o),placeholder:"选择图片尺寸"},{default:a(()=>[e(m,{label:"1024x1024 (正方形)",value:"1024x1024"}),e(m,{label:"1280x1280 (大正方形)",value:"1280x1280"}),e(m,{label:"1024x768 (横向)",value:"1024x768"}),e(m,{label:"768x1024 (纵向)",value:"768x1024"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(C,{span:12},{default:a(()=>[e(p,{label:"AI模型",prop:"model"},{default:a(()=>[e(A,{modelValue:n.model,"onUpdate:modelValue":t[2]||(t[2]=o=>n.model=o),placeholder:"选择AI模型"},{default:a(()=>[e(m,{label:"FLUX.1-schnell (快速)",value:"black-forest-labs/FLUX.1-schnell"}),e(m,{label:"Kolors (高质量)",value:"Kwai-Kolors/Kolors"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(P,{gutter:20},{default:a(()=>[e(C,{span:12},{default:a(()=>[e(p,{label:"生成数量",prop:"batch_size"},{default:a(()=>[e(R,{modelValue:n.batch_size,"onUpdate:modelValue":t[3]||(t[3]=o=>n.batch_size=o),min:1,max:4,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1}),e(C,{span:12},{default:a(()=>[e(p,{label:"随机种子"},{default:a(()=>[e(R,{modelValue:n.seed,"onUpdate:modelValue":t[4]||(t[4]=o=>n.seed=o),min:0,max:999999999,"controls-position":"right",placeholder:"留空随机生成"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(p,null,{default:a(()=>[e(w,{type:"primary",size:"large",loading:b.value,onClick:Q,class:"generate-btn"},{default:a(()=>[b.value?D("",!0):(r(),q(f,{key:0},{default:a(()=>[e(E)]),_:1})),U(" "+y(b.value?"生成中...":"开始生成"),1)]),_:1},8,["loading"]),e(w,{size:"large",onClick:W},{default:a(()=>t[8]||(t[8]=[U(" 重置 ")])),_:1,__:[8]})]),_:1})]),_:1},8,["model"])]),_:1})]),s("div",Ge,[e(S,{shadow:"never",class:"result-card"},{header:a(()=>[s("div",$e,[t[10]||(t[10]=s("span",null,"生成结果",-1)),v.value.length>0?(r(),q(w,{key:0,type:"text",onClick:j},{default:a(()=>t[9]||(t[9]=[U(" 清空 ")])),_:1,__:[9]})):D("",!0)])]),default:a(()=>[b.value?(r(),i("div",Be,[e(se,{rows:3,animated:""}),s("div",He,[e(oe,{percentage:_.value,"show-text":!1},null,8,["percentage"]),s("p",null,y(g.value),1)])])):v.value.length===0?(r(),i("div",qe,[e(G,{description:"暂无生成结果"},{image:a(()=>[e(f,{size:"60",color:"#dcdfe6"},{default:a(()=>[e(E)]),_:1})]),_:1})])):(r(),i("div",Ne,[(r(!0),i(N,null,T(v.value,(o,B)=>(r(),i("div",{key:B,class:"image-item"},[s("div",Te,[e($,{src:o.url,"preview-src-list":[o.url],fit:"cover",class:"generated-image",loading:"lazy"},{error:a(()=>[s("div",Xe,[e(f,null,{default:a(()=>[e(E)]),_:1}),t[11]||(t[11]=s("span",null,"加载失败",-1))])]),_:2},1032,["src","preview-src-list"]),s("div",Ke,[e(re,null,{default:a(()=>[e(w,{type:"primary",size:"small",onClick:ue=>J(o)},{default:a(()=>[e(f,null,{default:a(()=>[e(le)]),_:1})]),_:2},1032,["onClick"]),e(w,{type:"info",size:"small",onClick:ue=>Y(o.url)},{default:a(()=>[e(f,null,{default:a(()=>[e(ne)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),s("div",Me,[s("p",Oe,y(o.prompt),1),s("div",Qe,[s("span",null,y(o.size),1),s("span",null,y(o.model),1)])])]))),128))]))]),_:1})])]),s("div",We,[e(S,{shadow:"never"},{header:a(()=>[s("div",je,[t[13]||(t[13]=s("span",null,"生成历史",-1)),e(w,{type:"text",onClick:z},{default:a(()=>[e(f,null,{default:a(()=>[e(ie)]),_:1}),t[12]||(t[12]=U(" 刷新 "))]),_:1,__:[12]})])]),default:a(()=>[Se((r(),i("div",null,[I.value.length===0?(r(),i("div",Je,[e(G,{description:"暂无生成历史"})])):(r(),i("div",Ye,[(r(!0),i(N,null,T(I.value,o=>(r(),i("div",{key:o.id,class:"history-item",onClick:B=>Z(o)},[e($,{src:o.thumbnail||o.url,fit:"cover",class:"history-image"},{error:a(()=>[s("div",et,[e(f,null,{default:a(()=>[e(E)]),_:1})])]),_:2},1032,["src"]),s("div",tt,[s("p",at,y(o.prompt),1),s("p",st,y(De(Fe)(o.created_at)),1)])],8,Ze))),128))])),I.value.length>0?(r(),i("div",ot,[e(de,{"current-page":c.page,"onUpdate:currentPage":t[5]||(t[5]=o=>c.page=o),"page-size":c.pageSize,"onUpdate:pageSize":t[6]||(t[6]=o=>c.pageSize=o),total:c.total,"page-sizes":[12,24,48],layout:"total, sizes, prev, pager, next",onSizeChange:ee,onCurrentChange:te},null,8,["current-page","page-size","total"])])):D("",!0)])),[[ce,L.value]])]),_:1})])])}}}),nt=K(lt,[["__scopeId","data-v-7222fe5a"]]),rt={class:"generate-page"},it=M({__name:"index",setup(d){return(x,n)=>(r(),i("div",rt,[e(nt)]))}}),_t=K(it,[["__scopeId","data-v-75d49057"]]);export{_t as default};
