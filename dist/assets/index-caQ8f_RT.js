import{g as re,K as de,b as _e,d as ue,e as pe,f as ge,L as me,M as fe,a3 as he,N as ve,O as be,P as ye,Q as U,w as we,a4 as Ce,n as ke,a5 as xe,S as ze,T as Ee,a6 as Ie,p as Y,J as $e,V as Be,a7 as Me,a8 as De,W as Se,E as g,y as F}from"./element-plus-wIhg9Y3M.js";import{bu as z,cl as O,bQ as Re,bT as E,bU as b,bV as o,cb as e,c4 as l,c8 as v,bw as _,cB as Ve,c5 as P,c9 as i,c3 as K,ca as Te,cD as Le,bY as Ue}from"./vendor-CXaOXOXP.js";import{i as $}from"./api-D78is_CB.js";import{f as Ye,g as j}from"./index-zFB-kJVX.js";import{_ as Fe}from"./index-BLw7aUal.js";const Oe={class:"images-list"},Pe={class:"page-header"},je={class:"header-right"},Ke={class:"search-section"},Ne={class:"table-section"},Ge={class:"table-toolbar"},Qe={class:"toolbar-left"},Ae={class:"toolbar-right"},Je=["onClick"],We={class:"image-error"},qe={class:"user-info"},He={class:"user-id"},Xe={class:"username"},Ze={class:"title-text"},et={class:"prompt-text"},tt={class:"image-size"},at={class:"file-size"},lt={class:"time-info"},st={class:"relative-time"},ot={key:1,class:"grid-view"},nt={class:"image-grid"},it={class:"card-checkbox"},ct=["onClick"],rt={class:"image-error"},dt={class:"card-info"},_t={class:"card-title"},ut={class:"card-user"},pt={class:"card-prompt"},gt={class:"card-meta"},mt={class:"card-category"},ft={class:"card-size"},ht={class:"card-time"},vt={class:"card-actions"},bt={class:"pagination-wrapper"},yt={__name:"List",setup(N){const y=z(!1),k=z([]),u=z([]),w=z("table"),r=O({search:"",category:"",dateRange:null}),d=O({page:1,pageSize:24,total:0}),G=s=>{if(!s||s===0)return"0 B";const a=1024,n=["B","KB","MB","GB"],c=Math.floor(Math.log(s)/Math.log(a));return parseFloat((s/Math.pow(a,c)).toFixed(2))+" "+n[c]},B=s=>({realistic:"现实主义",cartoon:"卡通",abstract:"抽象",artistic:"艺术"})[s]||s||"未分类",Q=s=>({realistic:"primary",cartoon:"success",abstract:"warning",artistic:"danger"})[s]||"info",A=async(s,a)=>{try{const c=await(await fetch(s)).blob(),x=window.URL.createObjectURL(c),m=document.createElement("a");m.href=x,m.download=a,document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(x)}catch(n){throw console.error("下载失败:",n),n}},h=async()=>{y.value=!0;try{const s={page:d.page,limit:d.pageSize,search:r.search||void 0,category:r.category||void 0};r.dateRange&&r.dateRange.length===2&&(s.startDate=r.dateRange[0],s.endDate=r.dateRange[1]);const a=await $.getImages(s);a.success&&a.data?(k.value=a.data.images||[],d.total=a.data.total||0):g.error(a.message||"加载图片列表失败")}catch(s){g.error("加载图片列表失败"),console.error("加载图片列表失败:",s)}finally{y.value=!1}},M=()=>{d.page=1,h()},J=()=>{Object.assign(r,{search:"",category:"",dateRange:null}),d.page=1,h()},W=()=>{h()},q=s=>{u.value=s},H=s=>{const a=u.value.findIndex(n=>n.id===s.id);a>-1?u.value.splice(a,1):u.value.push(s)},X=s=>{d.pageSize=s,d.page=1,h()},Z=s=>{d.page=s,h()},D=s=>{},S=async s=>{try{const a=s.url||s.thumbnail;a?(await A(a,`image_${s.id}.png`),g.success("下载成功")):g.error("图片链接不存在")}catch(a){g.error("下载失败"),console.error("下载图片失败:",a)}},R=async s=>{try{await F.confirm(`确定要删除图片 "${s.title||`ID: ${s.id}`}" 吗？此操作不可恢复！`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=await $.deleteImage(s.id);a.success?(g.success("删除成功"),h()):g.error(a.message||"删除失败")}catch(a){a!=="cancel"&&(g.error("删除失败"),console.error("删除图片失败:",a))}},ee=async()=>{if(u.value.length!==0)try{await F.confirm(`确定要删除选中的 ${u.value.length} 张图片吗？此操作不可恢复！`,"确认批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const s=u.value.map(n=>n.id),a=await $.batchDeleteImages(s);a.success?(g.success("批量删除成功"),u.value=[],h()):g.error(a.message||"批量删除失败")}catch(s){s!=="cancel"&&(g.error("批量删除失败"),console.error("批量删除失败:",s))}};return Re(()=>{h()}),(s,a)=>{const n=re,c=_e,x=ge,m=pe,C=fe,te=me,ae=he,le=ue,V=ye,se=Ce,I=we,p=Ee,T=Ie,oe=$e,ne=ze,ie=Me,ce=Se,L=Be;return b(),E("div",Oe,[o("div",Pe,[a[8]||(a[8]=o("div",{class:"header-left"},[o("h2",{class:"page-title"},"图片管理"),o("p",{class:"page-description"},"管理系统中的所有生成图片")],-1)),o("div",je,[e(c,{type:"primary",onClick:W},{default:l(()=>[e(n,null,{default:l(()=>[e(_(de))]),_:1}),a[7]||(a[7]=v(" 刷新 "))]),_:1,__:[7]})])]),o("div",Ke,[e(V,{shadow:"never"},{default:l(()=>[e(le,{model:r,inline:""},{default:l(()=>[e(m,{label:"搜索关键词"},{default:l(()=>[e(x,{modelValue:r.search,"onUpdate:modelValue":a[0]||(a[0]=t=>r.search=t),placeholder:"搜索标题或提示词",clearable:"",onKeyup:Ve(M,["enter"]),style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(m,{label:"分类"},{default:l(()=>[e(te,{modelValue:r.category,"onUpdate:modelValue":a[1]||(a[1]=t=>r.category=t),placeholder:"选择分类",clearable:"",style:{width:"150px"}},{default:l(()=>[e(C,{label:"全部",value:""}),e(C,{label:"现实主义",value:"realistic"}),e(C,{label:"卡通",value:"cartoon"}),e(C,{label:"抽象",value:"abstract"}),e(C,{label:"艺术",value:"artistic"})]),_:1},8,["modelValue"])]),_:1}),e(m,{label:"生成时间"},{default:l(()=>[e(ae,{modelValue:r.dateRange,"onUpdate:modelValue":a[2]||(a[2]=t=>r.dateRange=t),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",clearable:"",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),e(m,null,{default:l(()=>[e(c,{type:"primary",onClick:M},{default:l(()=>[e(n,null,{default:l(()=>[e(_(ve))]),_:1}),a[9]||(a[9]=v(" 搜索 "))]),_:1,__:[9]}),e(c,{onClick:J},{default:l(()=>[e(n,null,{default:l(()=>[e(_(be))]),_:1}),a[10]||(a[10]=v(" 重置 "))]),_:1,__:[10]})]),_:1})]),_:1},8,["model"])]),_:1})]),o("div",Ne,[e(V,{shadow:"never"},{default:l(()=>[o("div",Ge,[o("div",Qe,[e(c,{type:"danger",disabled:u.value.length===0,onClick:ee},{default:l(()=>[e(n,null,{default:l(()=>[e(_(U))]),_:1}),v(" 批量删除 ("+i(u.value.length)+") ",1)]),_:1},8,["disabled"])]),o("div",Ae,[e(I,{content:"切换视图"},{default:l(()=>[e(se,null,{default:l(()=>[e(c,{type:w.value==="table"?"primary":"default",onClick:a[3]||(a[3]=t=>w.value="table")},{default:l(()=>[e(n,null,{default:l(()=>[e(_(ke))]),_:1})]),_:1},8,["type"]),e(c,{type:w.value==="grid"?"primary":"default",onClick:a[4]||(a[4]=t=>w.value="grid")},{default:l(()=>[e(n,null,{default:l(()=>[e(_(xe))]),_:1})]),_:1},8,["type"])]),_:1})]),_:1})])]),w.value==="table"?P((b(),K(ne,{key:0,data:k.value,onSelectionChange:q,stripe:"",border:""},{default:l(()=>[e(p,{type:"selection",width:"55",align:"center"}),e(p,{label:"图片预览",width:"120",align:"center"},{default:l(({row:t})=>[o("div",{class:"image-preview",onClick:f=>D(t)},[e(T,{src:t.url||t.thumbnail,"preview-src-list":[t.url||t.thumbnail],fit:"cover",class:"preview-img","preview-teleported":!0},{error:l(()=>[o("div",We,[e(n,null,{default:l(()=>[e(_(Y))]),_:1})])]),_:2},1032,["src","preview-src-list"])],8,Je)]),_:1}),e(p,{label:"图片ID",prop:"id",width:"100",align:"center"}),e(p,{label:"用户信息","min-width":"150"},{default:l(({row:t})=>[o("div",qe,[o("div",He,"ID: "+i(t.user_id||"未知"),1),o("div",Xe,i(t.username||"未知用户"),1)])]),_:1}),e(p,{label:"标题","min-width":"180"},{default:l(({row:t})=>[e(I,{content:t.title,placement:"top"},{default:l(()=>[o("div",Ze,i(t.title||"无标题"),1)]),_:2},1032,["content"])]),_:1}),e(p,{label:"提示词","min-width":"200"},{default:l(({row:t})=>[e(I,{content:t.prompt,placement:"top"},{default:l(()=>[o("div",et,i(t.prompt||"无提示词"),1)]),_:2},1032,["content"])]),_:1}),e(p,{label:"分类",width:"100",align:"center"},{default:l(({row:t})=>[e(oe,{size:"small",type:Q(t.category)},{default:l(()=>[v(i(B(t.category)),1)]),_:2},1032,["type"])]),_:1}),e(p,{label:"图片尺寸",width:"120",align:"center"},{default:l(({row:t})=>[o("div",tt,i(t.width&&t.height?`${t.width}×${t.height}`:"未知尺寸"),1)]),_:1}),e(p,{label:"文件大小",width:"100",align:"center"},{default:l(({row:t})=>[o("div",at,i(t.size?G(t.size):"未知大小"),1)]),_:1}),e(p,{label:"生成时间",width:"180",align:"center"},{default:l(({row:t})=>[o("div",lt,[o("div",null,i(_(Ye)(t.created_at)),1),o("div",st,i(_(j)(t.created_at)),1)])]),_:1}),e(p,{label:"操作",width:"120",align:"center",fixed:"right"},{default:l(({row:t})=>[e(c,{type:"primary",size:"small",link:"",onClick:f=>S(t)},{default:l(()=>a[11]||(a[11]=[v(" 下载 ")])),_:2,__:[11]},1032,["onClick"]),e(c,{type:"danger",size:"small",link:"",onClick:f=>R(t)},{default:l(()=>a[12]||(a[12]=[v(" 删除 ")])),_:2,__:[12]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[L,y.value]]):P((b(),E("div",ot,[o("div",nt,[(b(!0),E(Te,null,Le(k.value,t=>(b(),E("div",{key:t.id,class:Ue(["image-card",{selected:u.value.some(f=>f.id===t.id)}])},[o("div",it,[e(ie,{"model-value":u.value.some(f=>f.id===t.id),onChange:f=>H(t)},null,8,["model-value","onChange"])]),o("div",{class:"card-image",onClick:f=>D(t)},[e(T,{src:t.url||t.thumbnail,fit:"cover",class:"grid-img"},{error:l(()=>[o("div",rt,[e(n,null,{default:l(()=>[e(_(Y))]),_:1})])]),_:2},1032,["src"])],8,ct),o("div",dt,[o("div",_t,i(t.title||`ID: ${t.id}`),1),o("div",ut,"用户: "+i(t.username||t.user_id||"未知"),1),o("div",pt,i(t.prompt||"无提示词"),1),o("div",gt,[o("span",mt,i(B(t.category)),1),o("span",ft,i(t.width&&t.height?`${t.width}×${t.height}`:"未知尺寸"),1)]),o("div",ht,i(_(j)(t.created_at)),1)]),o("div",vt,[e(c,{size:"small",onClick:f=>S(t)},{default:l(()=>[e(n,null,{default:l(()=>[e(_(De))]),_:1})]),_:2},1032,["onClick"]),e(c,{size:"small",type:"danger",onClick:f=>R(t)},{default:l(()=>[e(n,null,{default:l(()=>[e(_(U))]),_:1})]),_:2},1032,["onClick"])])],2))),128))])])),[[L,y.value]]),o("div",bt,[e(ce,{"current-page":d.page,"onUpdate:currentPage":a[5]||(a[5]=t=>d.page=t),"page-size":d.pageSize,"onUpdate:pageSize":a[6]||(a[6]=t=>d.pageSize=t),total:d.total,"page-sizes":[12,24,48,96],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:X,onCurrentChange:Z},null,8,["current-page","page-size","total"])])]),_:1})])])}}},wt=Fe(yt,[["__scopeId","data-v-bbb83c3d"]]),It={__name:"index",setup(N){return(y,k)=>(b(),K(wt))}};export{It as default};
